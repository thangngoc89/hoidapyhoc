function sticky(){$("#quiz-sidebar, #mainRow").stick_in_parent()}function resize_do(){width=parseInt($(window).width()),scrollTop=parseInt($(window).scrollTop()),width<=767&&(scrollTop>=100?$("#quiz-sidebar").addClass("quiz-side-fixed"):$("#quiz-sidebar").removeClass("quiz-side-fixed"))}function validationError(e){$.each(e,function(e,t){t.forEach(function(e){toastr.warning(e)})})}function quizDoInt(){resize_do(),$(window).on("resize",function(){resize_do()}).on("scroll",function(){resize_do()}),$("#btnSheet").on("click",function(){$(".quiz-sidebar-section").slideToggle()}),$(".icontest-option").on("click",function(e){e.preventDefault(),toastr.info("Hãy nhấn bắt đầu để làm bài")}),$("#btnSubmit").on("click",function(){submitTest()}),$("#btnStart").on("click",function(){$(".icontest-option").off("click"),$("#quiz-content").removeClass("hide"),$("#quiz-rule").hide(),$("#btnSubmit").show(),$("#btnStart").hide(),sticky(),toastr.info("Bắt đầu làm bài thôi nào ^_^"),choiceDo(),setCounter()})}function setCounter(){counter=setInterval(timer,1e3),$.ajax({type:"POST",dataType:"json",url:"/api/v2/tests/"+testId+"/start",success:function(e){userHistoryId=e.user_history_id}})}function timer(){if(count-=1,-1==count)return clearInterval(counter),void sendSubmitTest();var e=count%60,t=Math.floor(count/60),n=Math.floor(t/60);t%=60,n%=60,$(".timecou").html(n+":"+t+":"+e)}function submitTest(){swal({title:"Bạn có muốn nộp bài chứ?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Có!",closeOnConfirm:!1},function(){sendSubmitTest()})}function sendSubmitTest(){$.ajax({type:"POST",dataType:"json",beforeSend:function(){$("#btnSubmit").button("loading")},url:$("#frmTest").attr("action"),data:{user_history_id:userHistoryId,test_id:testId,answers:gatherAnswer()},error:function(e){console.log(e.responseText),toastr.error("Có lỗi xảy ra. Vui lòng kiểm tra kĩ và thử lại")},success:function(e){swal({title:"Bạn làm đúng "+e.score+"/"+e.totalQuestion+" câu hỏi",text:"Bạn có muốn xem lại kết quả chi tiết chứ?",type:"success",showCancelButton:!0,confirmButtonClass:"btn-info",confirmButtonText:"Có chứ!",cancelButtonText:"Không, để làm lại!",closeOnConfirm:!0,closeOnCancel:!0},function(t){location.href=t?e.url:location.href})}})}function gatherAnswer(){var e=[];return $(".questionRow").each(function(){questionId=$(this).data("question-id"),questionOrder=$(this).data("question-order"),givenAnswer=$('input[id^="answer_'+questionOrder+'_"][value=1]').attr("name"),givenAnswer=givenAnswer?givenAnswer.substring(givenAnswer.length-1,givenAnswer.length):0,e.push(givenAnswer)}),e}function choiceDo(){$(".icontest-option").on("click",function(e){e.preventDefault(),questionId=$(this).data("question-id"),questionRow=$(this).parent().parent(),questionRow.alterClass("unanswered","answered"),questionOrder=questionRow.data("question-order");var t=$('a[id^="a_'+questionOrder+'_"]'),n=$('input[id^="answer_'+questionOrder+'_"]');t.each(function(){$(this).alterClass("op-*","op-"+$(this).html())}),n.each(function(){$(this).val(0)}),$(this).alterClass("op-*","op-choice"),$(this).siblings().val(1),updateAnswerCount()})}function updateAnswerCount(){answered=$("tr.answered").length,$("#answeredCount").html(answered),$(".userAnswerCount").attr("value",answered),totalAnswer=parseInt($("#totalAnswer").html()),answered>=totalAnswer/2&&$("#btnSubmit").attr("disabled",null)}!function(e){e.fn.alterClass=function(t,n){var a=this;if(-1===t.indexOf("*"))return a.removeClass(t),n?a.addClass(n):a;var o=new RegExp("\\s"+t.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");return a.each(function(t,n){for(var a=" "+n.className+" ";o.test(a);)a=a.replace(o," ");n.className=e.trim(a)}),n?a.addClass(n):a}}(jQuery),function(e){void 0==e.fn.ajaxForm&&e.getScript(("https:"==document.location.protocol?"https://":"http://")+"malsup.github.io/jquery.form.js");var t={};t.fileapi=void 0!==e("<input type='file'/>").get(0).files,t.formdata=void 0!==window.FormData,e.fn.uploadFile=function(n){function a(){v.afterUploadAll&&!C&&(C=!0,function e(){0!=g.sCounter&&g.sCounter+g.fCounter==g.tCounter?(v.afterUploadAll(g),C=!1):window.setTimeout(e,100)}())}function o(t,n,a){a.on("dragenter",function(t){t.stopPropagation(),t.preventDefault(),e(this).addClass(n.dragDropHoverClass)}),a.on("dragover",function(t){t.stopPropagation(),t.preventDefault();var a=e(this);a.hasClass(n.dragDropContainerClass)&&!a.hasClass(n.dragDropHoverClass)&&a.addClass(n.dragDropHoverClass)}),a.on("drop",function(a){a.preventDefault(),e(this).removeClass(n.dragDropHoverClass),t.errorLog.html("");var o=a.originalEvent.dataTransfer.files;return!n.multiple&&o.length>1?void(n.showError&&e("<div class='"+n.errorClass+"'>"+n.multiDragErrorStr+"</div>").appendTo(t.errorLog)):void(0!=n.onSelect(o)&&s(n,t,o))}),a.on("dragleave",function(){e(this).removeClass(n.dragDropHoverClass)}),e(document).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),e(document).on("dragover",function(t){t.stopPropagation(),t.preventDefault();var a=e(this);a.hasClass(n.dragDropContainerClass)||a.removeClass(n.dragDropHoverClass)}),e(document).on("drop",function(t){t.stopPropagation(),t.preventDefault(),e(this).removeClass(n.dragDropHoverClass)})}function r(e){var t="",n=e/1024;if(parseInt(n)>1024){var a=n/1024;t=a.toFixed(2)+" MB"}else t=n.toFixed(2)+" KB";return t}function i(t){var n=[];n="string"==jQuery.type(t)?t.split("&"):e.param(t).split("&");var a,o,r=n.length,i=[];for(a=0;r>a;a++)n[a]=n[a].replace(/\+/g," "),o=n[a].split("="),i.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])]);return i}function s(t,n,a){for(var o=0;o<a.length;o++)if(l(n,t,a[o].name))if(t.allowDuplicates||!d(n,a[o].name))if(-1!=t.maxFileSize&&a[o].size>t.maxFileSize)t.showError&&e("<div class='"+t.errorClass+"'><b>"+a[o].name+"</b> "+t.sizeErrorStr+r(t.maxFileSize)+"</div>").appendTo(n.errorLog);else if(-1!=t.maxFileCount&&n.selectedFiles>=t.maxFileCount)t.showError&&e("<div class='"+t.errorClass+"'><b>"+a[o].name+"</b> "+t.maxFileCountErrorStr+t.maxFileCount+"</div>").appendTo(n.errorLog);else{n.selectedFiles++,n.existingFileNames.push(a[o].name);var s=t,u=new FormData,c=t.fileName.replace("[]","");u.append(c,a[o]);var p=t.formData;if(p)for(var h=i(p),v=0;v<h.length;v++)h[v]&&u.append(h[v][0],h[v][1]);s.fileData=u;var w=new f(n,t),g="";g=t.showFileCounter?n.fileCounter+t.fileCounterStyle+a[o].name:a[o].name,w.filename.html(g);var b=e("<form style='display:block; position:absolute;left: 150px;' class='"+n.formGroup+"' method='"+t.method+"' action='"+t.url+"' enctype='"+t.enctype+"'></form>");b.appendTo("body");var C=[];C.push(a[o].name),m(b,s,w,C,n,a[o]),n.fileCounter++}else t.showError&&e("<div class='"+t.errorClass+"'><b>"+a[o].name+"</b> "+t.duplicateErrorStr+"</div>").appendTo(n.errorLog);else t.showError&&e("<div class='"+t.errorClass+"'><b>"+a[o].name+"</b> "+t.extErrorStr+t.allowedTypes+"</div>").appendTo(n.errorLog)}function l(e,t,n){var a=t.allowedTypes.toLowerCase().split(","),o=n.split(".").pop().toLowerCase();return"*"!=t.allowedTypes&&jQuery.inArray(o,a)<0?!1:!0}function d(e,t){var n=!1;if(e.existingFileNames.length)for(var a=0;a<e.existingFileNames.length;a++)(e.existingFileNames[a]==t||v.duplicateStrict&&e.existingFileNames[a].toLowerCase()==t.toLowerCase())&&(n=!0);return n}function u(e,t){if(e.existingFileNames.length)for(var n=0;n<t.length;n++){var a=e.existingFileNames.indexOf(t[n]);-1!=a&&e.existingFileNames.splice(a,1)}}function c(e,t){if(e){t.show();var n=new FileReader;n.onload=function(e){t.attr("src",e.target.result)},n.readAsDataURL(e)}}function p(t,n){if(t.showFileCounter){var a=e(".ajax-file-upload-filename").length;n.fileCounter=a+1,e(".ajax-file-upload-filename").each(function(){var n=e(this).html().split(t.fileCounterStyle),o=(parseInt(n[0])-1,a+t.fileCounterStyle+n[1]);e(this).html(o),a--})}}function h(n,a,o,r){var i="ajax-upload-id-"+(new Date).getTime(),d=e("<form method='"+o.method+"' action='"+o.url+"' enctype='"+o.enctype+"'></form>"),u="<input type='file' id='"+i+"' name='"+o.fileName+"' accept='"+o.acceptFiles+"'/>";o.multiple&&(o.fileName.indexOf("[]")!=o.fileName.length-2&&(o.fileName+="[]"),u="<input type='file' id='"+i+"' name='"+o.fileName+"' accept='"+o.acceptFiles+"' multiple/>");var c=e(u).appendTo(d);c.change(function(){n.errorLog.html("");var i=(o.allowedTypes.toLowerCase().split(","),[]);if(this.files){for(g=0;g<this.files.length;g++)i.push(this.files[g].name);if(0==o.onSelect(this.files))return}else{var u=e(this).val(),c=[];if(i.push(u),!l(n,o,u))return void(o.showError&&e("<div class='"+o.errorClass+"'><b>"+u+"</b> "+o.extErrorStr+o.allowedTypes+"</div>").appendTo(n.errorLog));if(c.push({name:u,size:"NA"}),0==o.onSelect(c))return}if(p(o,n),r.unbind("click"),d.hide(),h(n,a,o,r),d.addClass(a),t.fileapi&&t.formdata){d.removeClass(a);var v=this.files;s(o,n,v)}else{for(var w="",g=0;g<i.length;g++)w+=o.showFileCounter?n.fileCounter+o.fileCounterStyle+i[g]+"<br>":i[g]+"<br>",n.fileCounter++;if(-1!=o.maxFileCount&&n.selectedFiles+i.length>o.maxFileCount)return void(o.showError&&e("<div class='"+o.errorClass+"'><b>"+w+"</b> "+o.maxFileCountErrorStr+o.maxFileCount+"</div>").appendTo(n.errorLog));n.selectedFiles+=i.length;var b=new f(n,o);b.filename.html(w),m(d,o,b,i,n,null)}}),o.nestedForms?(d.css({margin:0,padding:0}),r.css({position:"relative",overflow:"hidden",cursor:"default"}),c.css({position:"absolute",cursor:"pointer",top:"0px",width:"100%",height:"100%",left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"}),d.appendTo(r)):(d.appendTo(e("body")),d.css({margin:0,padding:0,display:"block",position:"absolute",left:"-250px"}),-1!=navigator.appVersion.indexOf("MSIE ")?r.attr("for",i):r.click(function(){c.click()}))}function f(t,n){return this.statusbar=e("<div class='ajax-file-upload-statusbar'></div>").width(n.statusBarWidth),this.preview=e("<img class='ajax-file-upload-preview' />").width(n.previewWidth).height(n.previewHeight).appendTo(this.statusbar).hide(),this.filename=e("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar),this.progressDiv=e("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide(),this.progressbar=e("<div class='ajax-file-upload-bar "+t.formGroup+"'></div>").appendTo(this.progressDiv),this.abort=e("<div class='ajax-file-upload-red "+n.abortButtonClass+" "+t.formGroup+"'>"+n.abortStr+"</div>").appendTo(this.statusbar).hide(),this.cancel=e("<div class='ajax-file-upload-red "+n.cancelButtonClass+" "+t.formGroup+"'>"+n.cancelStr+"</div>").appendTo(this.statusbar).hide(),this.done=e("<div class='ajax-file-upload-green'>"+n.doneStr+"</div>").appendTo(this.statusbar).hide(),this.download=e("<div class='ajax-file-upload-green'>"+n.downloadStr+"</div>").appendTo(this.statusbar).hide(),this.del=e("<div class='ajax-file-upload-red'>"+n.deletelStr+"</div>").appendTo(this.statusbar).hide(),n.showQueueDiv?e("#"+n.showQueueDiv).append(this.statusbar):t.errorLog.after(this.statusbar),this}function m(n,o,r,s,l,d){var h={cache:!1,contentType:!1,processData:!1,forceSync:!1,type:o.method,data:o.formData,formData:o.fileData,dataType:o.returnType,beforeSubmit:function(e,t,d){if(0!=o.onSubmit.call(this,s)){var c=o.dynamicFormData();if(c){var h=i(c);if(h)for(var f=0;f<h.length;f++)h[f]&&(void 0!=o.fileData?d.formData.append(h[f][0],h[f][1]):d.data[h[f][0]]=h[f][1])}return l.tCounter+=s.length,a(),!0}return r.statusbar.append("<div class='"+o.errorClass+"'>"+o.uploadErrorStr+"</div>"),r.cancel.show(),n.remove(),r.cancel.click(function(){u(l,s),r.statusbar.remove(),o.onCancel.call(l,s,r),l.selectedFiles-=s.length,p(o,l)}),!1},beforeSend:function(e){r.progressDiv.show(),r.cancel.hide(),r.done.hide(),o.showAbort&&(r.abort.show(),r.abort.click(function(){u(l,s),e.abort(),l.selectedFiles-=s.length})),r.progressbar.width(t.formdata?"1%":"5%")},uploadProgress:function(e,t,n,a){a>98&&(a=98);var i=a+"%";a>1&&r.progressbar.width(i),o.showProgress&&(r.progressbar.html(i),r.progressbar.css("text-align","center"))},success:function(t,a,i){if("json"==o.returnType&&"object"==e.type(t)&&t.hasOwnProperty(o.customErrorKeyStr)){r.abort.hide();var d=t[o.customErrorKeyStr];return o.onError.call(this,s,200,d,r),o.showStatusAfterError?(r.progressDiv.hide(),r.statusbar.append("<span class='"+o.errorClass+"'>ERROR: "+d+"</span>")):(r.statusbar.hide(),r.statusbar.remove()),l.selectedFiles-=s.length,n.remove(),void(l.fCounter+=s.length)}l.responses.push(t),r.progressbar.width("100%"),o.showProgress&&(r.progressbar.html("100%"),r.progressbar.css("text-align","center")),r.abort.hide(),o.onSuccess.call(this,s,t,i,r),o.showStatusAfterSuccess?(o.showDone?(r.done.show(),r.done.click(function(){r.statusbar.hide("slow"),r.statusbar.remove()})):r.done.hide(),o.showDelete?(r.del.show(),r.del.click(function(){r.statusbar.hide().remove(),o.deleteCallback&&o.deleteCallback.call(this,t,r),l.selectedFiles-=s.length,p(o,l)})):r.del.hide()):(r.statusbar.hide("slow"),r.statusbar.remove()),o.showDownload&&(r.download.show(),r.download.click(function(){o.downloadCallback&&o.downloadCallback(t)})),n.remove(),l.sCounter+=s.length},error:function(e,t,a){r.abort.hide(),"abort"==e.statusText?(r.statusbar.hide("slow").remove(),p(o,l)):(o.onError.call(this,s,t,a,r),o.showStatusAfterError?(r.progressDiv.hide(),r.statusbar.append("<span class='"+o.errorClass+"'>ERROR: "+a+"</span>")):(r.statusbar.hide(),r.statusbar.remove()),l.selectedFiles-=s.length),n.remove(),l.fCounter+=s.length}};o.showPreview&&null!=d&&"image"==d.type.toLowerCase().split("/").shift()&&c(d,r.preview),o.autoSubmit?n.ajaxSubmit(h):(o.showCancel&&(r.cancel.show(),r.cancel.click(function(){u(l,s),n.remove(),r.statusbar.remove(),o.onCancel.call(l,s,r),l.selectedFiles-=s.length,p(o,l)})),n.ajaxForm(h))}var v=e.extend({url:"",method:"POST",enctype:"multipart/form-data",returnType:null,allowDuplicates:!0,duplicateStrict:!1,allowedTypes:"*",acceptFiles:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,maxFileCount:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!0,showDelete:!1,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!0,fileCounterStyle:"). ",showProgress:!1,nestedForms:!0,showDownload:!1,onLoad:function(){},onSelect:function(){return!0},onSubmit:function(){},onSuccess:function(){},onError:function(){},onCancel:function(){},downloadCallback:!1,deleteCallback:!1,afterUploadAll:!1,abortButtonClass:"ajax-file-upload-abort",cancelButtonClass:"ajax-file-upload-cancel",dragDropContainerClass:"ajax-upload-dragdrop",dragDropHoverClass:"state-hover",errorClass:"ajax-file-upload-error",uploadButtonClass:"ajax-file-upload",dragDropStr:"<span><b>Drag &amp; Drop Files</b></span>",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",duplicateErrorStr:"is not allowed. File already exists.",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:" is not allowed. Maximum allowed files are:",downloadStr:"Download",customErrorKeyStr:"jquery-upload-file-error",showQueueDiv:!1,statusBarWidth:500,dragdropWidth:500,showPreview:!1,previewHeight:"auto",previewWidth:"100%",uploadFolder:"uploads/"},n);this.fileCounter=1,this.selectedFiles=0,this.fCounter=0,this.sCounter=0,this.tCounter=0;var w="ajax-file-upload-"+(new Date).getTime();this.formGroup=w,this.hide(),this.errorLog=e("<div></div>"),this.after(this.errorLog),this.responses=[],this.existingFileNames=[],t.formdata||(v.dragDrop=!1),t.formdata||(v.multiple=!1);var g=this,b=e("<div>"+e(this).html()+"</div>");e(b).addClass(v.uploadButtonClass),function x(){if(e.fn.ajaxForm){if(v.dragDrop){var t=e('<div class="'+v.dragDropContainerClass+'" style="vertical-align:top;"></div>').width(v.dragdropWidth);e(g).before(t),e(t).append(b),e(t).append(e(v.dragDropStr)),o(g,v,t)}else e(g).before(b);v.onLoad.call(this,g),h(g,w,v,b)}else window.setTimeout(x,10)}(),this.startUpload=function(){e("."+this.formGroup).each(function(){e(this).is("form")&&e(this).submit()})},this.getFileCount=function(){return g.selectedFiles},this.stopUpload=function(){e("."+v.abortButtonClass).each(function(){e(this).hasClass(g.formGroup)&&e(this).click()})},this.cancelAll=function(){e("."+v.cancelButtonClass).each(function(){e(this).hasClass(g.formGroup)&&e(this).click()})},this.update=function(t){v=e.extend(v,t)},this.createProgress=function(e){var t=new f(this,v);t.progressDiv.show(),t.progressbar.width("100%");var n="";n=v.showFileCounter?g.fileCounter+v.fileCounterStyle+e:e,t.filename.html(n),g.fileCounter++,g.selectedFiles++,v.showPreview&&(t.preview.attr("src",v.uploadFolder+e),t.preview.show()),v.showDownload&&(t.download.show(),t.download.click(function(){v.downloadCallback&&v.downloadCallback.call(g,[e])})),t.del.show(),t.del.click(function(){t.statusbar.hide().remove();var n=[e];v.deleteCallback&&v.deleteCallback.call(this,n,t),g.selectedFiles-=1,p(v,g)})},this.getResponses=function(){return this.responses};var C=!1;return this}}(jQuery),$(function(){$.ajaxSetup({headers:{"X-XSRF-Token":$('meta[name="csrf"]').attr("content")}}),$("img").unveil(200),$("#q").selectize({valueField:"url",labelField:"name",searchField:["name"],maxOptions:10,options:[],create:!1,render:{option:function(e,t){return"<div>"+t(e.name)+"</div>"}},optgroups:[{value:"tag",label:"Tag"},{value:"exam",label:"Đề thi"}],optgroupField:"group",optgroupOrder:["exam","tag"],load:function(e,t){return e.length?void $.ajax({url:"/api/v2/search",type:"GET",dataType:"json",data:{q:e},error:function(){t()},success:function(e){t(e.data)}}):t()},onChange:function(){window.location=this.items[0]}})}),toastr.options={closeButton:!1,debug:!1,progressBar:!1,positionClass:"toast-bottom-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},function(e){function t(){u(),d(),l(),e("#frmTest").on("submit",function(e){e.preventDefault(),a()}),sticky(),C(),g(),x()}function n(){test=global.data.test,S.name.val(test.name),S.description.val(test.description),S.content.html(test.content),S.begin.html(test.begin),test.file&&(S.tabContent.last().tab("show"),b(test.file)),test.tags&&S.tag.val(test.tags.join()),S.adjustTotal.hide(),D.postAjaxMethod="PUT",D.postUrl="/api/v2/tests/"+test.id,t()}function a(){data=r(),data&&e.ajax({type:D.postAjaxMethod,dataType:"json",url:D.postUrl,data:data,beforesend:function(){S.btnCreateSubmit.button("loading")},error:function(t){toastr.error("Có lỗi xảy ra. Vui lòng kiểm tra kĩ và thử lại"),t=e.parseJSON(t.responseText),validationError(t),y(t),S.btnCreateSubmit.button("reset")},success:function(e){o(e)}})}function o(e){swal({title:"Đã gửi đề thi thành công",text:"Làm gì tiếp theo?",type:"success",showCancelButton:!0,confirmButtonClass:"btn-info",confirmButtonText:"Xem đề thi",cancelButtonText:"Chỉnh sửa",closeOnConfirm:!0,closeOnCancel:!0},function(t){D.preventClose=!1,location.href=t?e.url:e.editUrl})}function r(){if(!v())return!1;if(name=e("#input-name").val(),description=e("#input-description").val(),content=e("#content").editable("getHTML"),begin=e("#begin").val(),begin=parseInt(begin)>=1?parseInt(begin):1,tags=e("#select-tags").val(),time=e("#select-time").val(),is_file=0,file_id=null,!name||name.length<6)return toastr.warning("Tên đề thi có độ dài tối thiểu là 6"),!1;if(description&&description.length<6)return toastr.warning("Mô tả có độ dài tối thiểu là 6"),!1;if(pdf_upload=e('a[role="tab"][aria-expanded="true"]').attr("href"),"#upload"==pdf_upload){if(!global.pdf_file_id)return toastr.warning("Bạn chưa upload file pdf"),!1;is_file=1,file_id=global.pdf_file_id}return content?{name:name,description:description,content:content,begin:begin,tags:tags,thoigian:time,is_file:is_file,file_id:file_id,questions:s()}:(toastr.warning("Bạn chưa nhập nội dung đề thi"),!1)}function s(){var t=[];return e(".ansRow").each(function(n){questionOrder=e(this).data("question-order"),givenAnswer=e('input[id^="answer_'+questionOrder+'_"][value=1]').attr("name"),givenAnswer=givenAnswer.substring(givenAnswer.length-1,givenAnswer.length),question={right_answer:givenAnswer.toUpperCase(),content:D.answerArray[n+1]?D.answerArray[n+1]:""},t.push(question)}),t}function l(){choiceDo(),w(),sticky()}function d(){e("#btn-add").on("click",function(t){t.preventDefault(),c(e("#total_add").val())}),e("#btn-remove").on("click",function(t){t.preventDefault(),p(e("#total_remove").val())}),e("#begin").on("keyup",function(){f()})}function u(){global.data.test?c(global.data.test.questionsCount,global.data.test.questions):c(5,!1)}function c(t,n){for(i=1;i<=t;i++)qIndex=e(".ansRow:last").data("question-order"),qIndex=qIndex?qIndex:0,dataNode=n?n[i-1]:!1,h(parseInt(qIndex)+1,dataNode);l(),m(),f()}function p(t){if(m()-parseInt(t)<1)return toastr.warning("Tổng số câu hỏi không được nhỏ hơn 1"),!1;for(qIndex=e(".ansRow:last").data("question-order"),toIndex=parseInt(qIndex)-parseInt(t),i=qIndex;i>toIndex;i--)e('tr[data-question-order="'+i+'"]').remove();m()}function h(t,n){selectedAnswer=!1,content=!1,answerd="",n&&(selectedAnswer=n.answer.toLowerCase(),content=n.content,answerd=" answered",content&&(D.answerArray[t]=content)),row='<tr class="ansRow'+answerd+'" data-question-order="'+t+'"><td align="center" class="questionNumber">'+t+".</td>",["a","b","c","d","e"].forEach(function(e){opchoice=selectedAnswer==e?" op-choice":"",value=selectedAnswer==e?1:0,hinted=content?" hinted":"",row+='<td><a id="a_'+t+"_"+e+'" rel="1" class="icontest-option op-'+e+opchoice+'"href="#"">'+e+'</a><input type="hidden" id="answer_'+t+"_"+e+'" name="answer_'+t+"_"+e+'" value="'+value+'"></td>'}),row+='<td><a href="javscript::void(0)" class="iconHint"><i class="zn-icon icon-hint'+hinted+'"></i></a></td></tr>',e("#answer>tbody").append(row)}function f(){val=e("#begin").val(),val=parseInt(val)>=1?parseInt(val):1,e(".questionNumber").each(function(t){e(this).html(parseInt(t)+val+".")})}function m(){return total=e(".ansRow").length,e("#total").html(total),total}function v(){return unanswered=e('.ansRow:not(".answered")').length,0!=unanswered&&toastr.warning("Bạn chưa điền đầy đủ đáp án cho các câu hỏi"),0==unanswered}function w(){e(".icon-hint").unbind("click"),e(".icon-hint").on("click",function(){qIndex=e(this).closest("tr").data("question-order"),hint=e("#answerModalArea"),icon=e(this),currentValue=D.answerArray[qIndex]?D.answerArray[qIndex]:"",hint.val(currentValue),questionNumber=parseInt(qIndex)+parseInt(S.begin.val())-1,e("#answerModal .modal-title").html("Gợi ý trả lời cho câu "+questionNumber),D.preventClose=!1,e("#answerModal").modal().on("hide.bs.modal",function(){D.preventClose=!0,D.answerArray[qIndex]=hint.val(),icon.removeClass("hinted"),hint.val()&&icon.addClass("hinted")})})}function g(){e("#uploadarea").uploadFile({url:"/api/v2/files",maxFileSize:10485760,allowedTypes:"pdf",showStatusAfterSuccess:!1,formData:{type:"json"},dragDropStr:"<span><b>Kéo và thả file vào đây để upload</b></span>",sizeErrorStr:"quá lớn. Dung lượng file tối đa là ",uploadErrorStr:"Đã có lỗi xảy ra trong quá trình upload",uploadButtonClass:"btn btn-info",onSuccess:function(e,t){b(t)}})}function b(t){e("#pdf").html('<iframe width="100%" height="750px" src="http://hoidapyhoc.com/assets/pdfjs/web/viewer.html?file='+t.url+'"></iframe>'),global.pdf_file_id=t.id}function C(){e("#content").editable({inlineMode:!0,alwaysVisible:!0});e('a[href*="froala.com"]').closest("div").hide(),e("#select-tags").selectize({plugins:["remove_button"],options:global.data.tags,valueField:"text",labelField:"text",create:function(e){return{value:e,text:e}},maxItems:3,render:{option:function(e){var t=e.text,n=e.count;return'<div><span class="post-tag">'+t+'</span><span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">'+n+"</span></span></div>"}}})}function x(){window.onbeforeunload=function(e){return e=e||window.event,D.preventClose?(e&&(e.returnValue="Bạn có chắc chắn muốn thoát ? "),"Bạn có chắc chắn muốn thoát ? "):void 0}}function y(e){window.console.log(e)}e.fn.quiz=function(){switch(data=global.data,data.type){case"edit":n();break;case"create":t()}};var S={name:e("#input-name"),content:e("#content"),description:e("#input-description"),begin:e("#begin"),tag:e("#select-tags"),tabContent:e("#tab-content a"),adjustTotal:e("#adjustTotal"),answerTable:e("#answer"),btnCreateSubmit:e("#btnCreateSubmit")},D={postUrl:"/api/v2/tests",postAjaxMethod:"POST",answerArray:{},preventClose:!0}}(jQuery);